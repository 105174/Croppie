!function(t,e){"function"==typeof define&&define.amd?define(["exports","b"],e):"object"==typeof exports&&"string"!=typeof exports.nodeName?e(exports,require("b")):e(t.commonJsStrict={},t.b)}(this,function(exports,t){function e(t){if(t in R)return t;for(var e=t[0].toUpperCase()+t.slice(1),n=Y.length;n--;)if(t=Y[n]+e,t in R)return t}function n(t){t=t||{};for(var e=1;e<arguments.length;e++){var i=arguments[e];if(i)for(var o in i)i.hasOwnProperty(o)&&("object"==typeof i[o]?t[o]=n({},i[o]):t[o]=i[o])}return t}function i(t,e,n){var i;return function(){var o=this,r=arguments,a=function(){i=null,n||t.apply(o,r)},s=n&&!i;clearTimeout(i),i=setTimeout(a,e),s&&t.apply(o,r)}}function o(t,e,n){if("string"==typeof e){var i=e;e={},e[i]=n}for(var o in e)t.style[o]=e[o]}function r(t){var e=t.points,n=document.createElement("div"),i=document.createElement("img"),r=e[2]-e[0],a=e[3]-e[1];t.zoom;return n.classList.add("croppie-result"),n.appendChild(i),o(i,{left:-1*e[0]+"px",top:-1*e[1]+"px"}),i.src=t.imgSrc,o(n,{width:r+"px",height:a+"px"}),n}function a(t,e){var n=e.points,i=(e.zoom,n[0]),o=n[1],r=n[2]-n[0],a=n[3]-n[1],s=e.circle,l=document.createElement("canvas"),c=l.getContext("2d");return l.width=r,l.height=a,s&&(c.save(),c.beginPath(),c.arc(r/2,a/2,r/2,0,2*Math.PI,!0),c.closePath(),c.clip()),c.drawImage(t,i,o,r,a,0,0,r,a),l.toDataURL()}function s(t){var e,n=new Image;return e=new Promise(function(e,i){n.onload=function(){e(n)},n.src=t})}function l(){var t=this,e=["croppie-container"],n=t.boundary=document.createElement("div"),i=t.viewport=document.createElement("div"),r=t.img=document.createElement("img"),a=t.overlay=document.createElement("div"),s=t.options.viewport.type?"cr-vp-"+t.options.viewport.type:null;n.classList.add("cr-boundary"),o(n,{width:t.options.boundary.width+"px",height:t.options.boundary.height+"px"}),i.classList.add("cr-viewport"),s&&i.classList.add(s),o(i,{width:t.options.viewport.width+"px",height:t.options.viewport.height+"px"}),r.classList.add("cr-image"),a.classList.add("cr-overlay"),t.element.appendChild(n),n.appendChild(r),n.appendChild(i),n.appendChild(a),t.element.classList.add(e),t.options.customClass&&t.element.classList.add(t.options.customClass),m.call(this),t.options.showZoom&&c.call(t)}function c(){function t(){d.call(a),i=new B(a.img),o=a.viewport.getBoundingClientRect(),r=z.parse(a.img)}function e(){p.call(a,{value:parseFloat(l.value),origin:i,viewportRect:o||a.viewport.getBoundingClientRect(),transform:r})}function n(n){var i=n.deltaY/-1e3,o=a._currentZoom+i;n.preventDefault(),t(),l.value=o,e()}var i,o,r,a=this,s=document.createElement("div"),l=a.zoomer=document.createElement("input");s.classList.add("cr-slider-wrap"),l.type="range",l.classList.add("cr-slider"),l.step="0.01",l.value=1,a.element.appendChild(s),s.appendChild(l),a._currentZoom=1,a.zoomer.addEventListener("mousedown",t),a.zoomer.addEventListener("touchstart",t),a.zoomer.addEventListener("input",e),a.zoomer.addEventListener("change",e),a.options.mouseWheelZoom&&(a.boundary.addEventListener("mousewheel",n),a.boundary.addEventListener("DOMMouseScroll",n))}function p(t){var e=this,n=t.transform,i=t.viewportRect,r=t.origin;e._currentZoom=t.value,n.scale=e._currentZoom;var a=u.call(e,i),s=a.translate,l=a.origin;n.x>=s.maxX&&(r.x=l.minX,n.x=s.maxX),n.x<=s.minX&&(r.x=l.maxX,n.x=s.minX),n.y>=s.maxY&&(r.y=l.minY,n.y=s.maxY),n.y<=s.minY&&(r.y=l.maxY,n.y=s.minY);var c={};c[E]=n.toString(),c[b]=r.toString(),o(e.img,c),Z.call(e),g.call(e)}function u(t){var e=this,n=e._currentZoom,i=t.width,o=t.height,r=e.options.boundary.width/2,a=e.options.boundary.height/2,s=e._originalImageWidth,l=e._originalImageHeight,c=s*n,p=l*n,u=i/2,d=o/2,m=-1*(u/n-r),h=m-(c*(1/n)-i*(1/n)),g=-1*(d/n-a),v=g-(p*(1/n)-o*(1/n)),f=1/n*u,y=c*(1/n)-f,w=1/n*d,x=p*(1/n)-w;return{translate:{maxX:m,minX:h,maxY:g,minY:v},origin:{maxX:y,minX:f,maxY:x,minY:w}}}function d(){var t=this,e=t._currentZoom,n=t.img.getBoundingClientRect(),i=t.viewport.getBoundingClientRect(),r=z.parse(t.img.style[E]),a=new B(t.img),s=i.top-n.top+i.height/2,l=i.left-n.left+i.width/2,c={},p={};c.y=s/e,c.x=l/e,p.y=(c.y-a.y)*(1-e),p.x=(c.x-a.x)*(1-e),r.x-=p.x,r.y-=p.y;var u={};u[b]=c.x+"px "+c.y+"px",u[E]=r.toString(),o(t.img,u)}function m(){function t(t){t.preventDefault(),c||(c=!0,i=t.pageX,r=t.pageY,transform=z.parse(l.img),window.addEventListener("mousemove",e),window.addEventListener("touchmove",e),window.addEventListener("mouseup",n),window.addEventListener("touchend",n),document.body.style[L]="none",s=l.viewport.getBoundingClientRect())}function e(t){t.preventDefault();var e=t.pageX||t.touches[0].pageX,n=t.pageY||t.touches[0].pageY,c=e-i,p=n-r,u=l.img.getBoundingClientRect(),d=transform.y+p,m=transform.x+c,g={};if("touchmove"==t.type&&t.touches.length>1){var v=t.touches[0],f=t.touches[1],y=Math.sqrt((v.pageX-f.pageX)*(v.pageX-f.pageX)+(v.pageY-f.pageY)*(v.pageY-f.pageY));a||(a=y/l._currentZoom);var w=y/a;return l.zoomer.value=w,void l.zoomer.dispatchEvent("change")}s.top>u.top+p&&s.bottom<u.bottom+p&&(transform.y=d),s.left>u.left+c&&s.right<u.right+c&&(transform.x=m),g[E]=transform.toString(),o(l.img,g),h.call(l),r=n,i=e}function n(t){c=!1,window.removeEventListener("mousemove",e),window.removeEventListener("touchmove",e),window.removeEventListener("mouseup",n),window.removeEventListener("touchend",n),document.body.style[L]="none",d.call(l),g.call(l),a=0}var i,r,a,s,l=this,c=!1;l.overlay.addEventListener("mousedown",t),l.overlay.addEventListener("touchstart",t)}function h(){var t=this,e=t.boundary.getBoundingClientRect(),n=t.img.getBoundingClientRect();o(t.overlay,{width:n.width+"px",height:n.height+"px",top:n.top-e.top+"px",left:n.left-e.left+"px"})}function g(){var t=this;t.options.update.call(t,t.get())}function v(){var t=this,e=t.img.getBoundingClientRect(),n=0,i=1.5;t._originalImageWidth=e.width,t._originalImageHeight=e.height,t.options.showZoom&&(n=t.boundary.getBoundingClientRect().width/e.width,t.zoomer.min=n,t.zoomer.max=i,t.zoomer.value=1),h.call(t)}function f(t){if(4!=t.length)throw"Croppie - Invalid number of points supplied: "+t;var e=this,n=t[2]-t[0],i=(t[3]-t[1],e.viewport.getBoundingClientRect()),r=e.boundary.getBoundingClientRect(),a={left:i.left-r.left,top:i.top-r.top},s=i.width/n,l=t[1],c=t[0],p=-1*t[1]+a.top,u=-1*t[0]+a.left,d={};d[b]=c+"px "+l+"px",d[E]=new z(u,p,s).toString(),o(e.img,d),e.zoomer.value=s,e._currentZoom=s}function y(t,e){var n,i=this,o=[];"string"==typeof t?(n=t,t={}):(n=t.url,o=t.points),log(t),i.imgSrc=n;var r=s(n);return r.then(function(){i.img.src=n,v.call(i),o.length&&f.call(i,o),g.call(i),e&&e()}),r}function w(){var t=this,e=(t.img.src,t.img.getBoundingClientRect()),n=t.viewport.getBoundingClientRect(),i=n.left-e.left,o=n.top-e.top,r=i+n.width,a=o+n.height,s=t._currentZoom;return i/=s,r/=s,o/=s,a/=s,{points:[i,o,r,a],zoom:s}}function x(t){var e,n=this,i=w.call(n);return i.circle="circle"===n.options.viewport.type,i.imgSrc=n.imgSrc,t=t||"html",e=new Promise(function(e,o){"canvas"===t?s(n.imgSrc).then(function(t){e(a(t,i))}):e(r(i))})}function C(t,e){this.element=t,this.options=n({},C.defaults,e),l.call(this)}var b,E,L,Y=["Webkit","Moz","ms"],R=document.createElement("div").style;E=e("transform"),b=e("transformOrigin"),L=e("userSelect");var S="translate3d",X=", 0px",z=function(t,e,n){this.x=parseFloat(t),this.y=parseFloat(e),this.scale=parseFloat(n)};z.parse=function(t){return t.style?z.parse(t.style[E]):t.indexOf("matrix")>-1||t.indexOf("none")>-1?z.fromMatrix(t):z.fromString(t)},z.fromMatrix=function(t){var e=t.substring(7).split(",");return e.length&&"none"!==t||(e=[1,0,0,1,0,0]),new z(parseInt(e[4],10),parseInt(e[5],10),parseFloat(e[0]))},z.fromString=function(t){var e=t.split(") "),n=e[0].substring(S.length+1).split(","),i=e.length>1?e[1].substring(6):1,o=n.length>1?n[0]:0,r=n.length>1?n[1]:0;return new z(o,r,i)},z.prototype.toString=function(){return S+"("+this.x+"px, "+this.y+"px"+X+") scale("+this.scale+")"};var B=function(t){if(!t||!t.style[b])return this.x=0,void(this.y=0);var e=t.style[b].split(" ");this.x=parseFloat(e[0]),this.y=parseFloat(e[1])};B.prototype.toString=function(){return this.x+"px "+this.y+"px"};var Z=i(h,500);if(this.jQuery){var $=this.jQuery;$.fn.croppie=function(t){var e=typeof t;if("string"===e){var n=Array.prototype.slice.call(arguments,1),i=$(this).data("croppie");return"get"===t?i.get():"result"===t?i.result.apply(i,n):this.each(function(){var e=$(this).data("croppie");if(e){var i=e[t];if(!$.isFunction(i))throw"Croppie "+t+" method not found";i.apply(e,n)}})}return this.each(function(){var e=new C(this,t);$(this).data("croppie",e)})}}C.defaults={viewport:{width:100,height:100,type:"square"},boundary:{width:300,height:300},customClass:"",showZoom:!0,mouseWheelZoom:!0,update:function(){}},n(C.prototype,{bind:function(t,e){return y.call(this,t,e)},get:function(){return w.call(this)},result:function(t){return x.call(this,t)}}),exports.Croppie=window.Croppie=C});